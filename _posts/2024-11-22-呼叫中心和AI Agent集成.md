---
title: 呼叫中心和AI Agent集成
date: 2024-11-22 11:30:11 +0800
categories: 技术
tags:
  - AI
  - 呼叫中心
  - 实时语音
layout: single
toc: "true"
toc_label: 目录
toc_icon: list
toc_sticky: "true"
sidebar:
  nav: docs
comments: "true"
mermaid: "true"
---
目前传统电话接入方式仍在广泛使用，不过越来越多的呼叫中心开始采用基于IP的通信技术，如SIP中继等，来替代传统的PSTN线路，以获得更好的扩展性和成本效益。当前有如下的趋势：
1. 越来越多的呼叫中心正在从数字线路迁移到VoIP技术
2. 混合部署模式比较常见，同时支持数字线路和VoIP接入
3. 云呼叫中心基本都采用VoIP技术
4. 5G技术的发展将进一步推动VoIP技术的应用

所以本文就以VoIP技术为例，来详细解释呼叫中心的架构以及如何和最新的AI技术进行融合。

### 呼叫中心完整架构

这个架构支持多种服务模式的无缝切换，并可以根据不同场景智能调度到相应的服务模块。

![呼叫中心架构图.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/b0cdd7e139085b5d7e2cb561827f49f8.svg)

#### 1. PSTN网络层:

- 本地交换机(Local Exchange): 处理本地固定电话接入
- 中继线路(Trunk Line): 连接PSTN网络与呼叫中心

#### 2. 运营商网络层:

- 移动交换中心(MSC): 处理移动用户接入
- 网关移动交换中心(GMSC): 连接移动网络与VoIP网络

#### 3. 网关层

- TDM网关层: 处理传统电路交换网络接入
	- E1网关: 处理E1数字中继接入
	- SS7信令网关: 处理SS7信令
	- PRI中继网关: 处理ISDN PRI接入
- IP网关层: 
	-  SBC(Session Border Controller): 处理外部电话接入
	- WebRTC网关: 支持网页端实时通讯
	- SIP网关: 处理SIP协议通信
  主要连接关系:
	1. 固定电话用户 -> 本地交换机 -> 中继线路 -> TDM网关(E1/SS7/PRI) ->数字PBX-数字ACD （传统的数字链路）
	2. 固定电话用户-> 本地交换机 -> 中继线路 ->SIP-PSTN网关->SIP中继 （VoIP接入）
	3. 移动用户 -> MSC -> GMSC -> SBC （VoIP接入）
	4. 网页用户 -> WebRTC网关
	5. APP用户 -> SIP网关
#### 4. 核心服务层

1. SIP服务集群，用于处理SIP协议通信，SIP协议是用于发起、修改和终止多媒体会话（如语音和视频通话）的信令协议。它类似于互联网通信中的 “语言”，用于在不同设备之间传达会话相关的指令。例如，当你在呼叫中心使用 VoIP 电话拨打一个号码时，SIP 协议就负责建立连接、协商通话参数等操作。SIP服务集群包含：
	
		- 注册服务器(Registration Server)：处理终端注册
		- 代理服务器(Proxy Server)：处理SIP信令路由
		- 定位服务器(Location Server)：管理用户位置信息
	
2. PBX系统集群，- PBX 是一种电话交换系统，用于呼叫中心内部电话通信的交换和管理。在呼叫中心的 VoIP 系统中，PBX 起到了核心的作用，它类似于一个交通枢纽，负责将呼叫路由到正确的坐席或者外部线路。用于处理呼叫控制，PBX系统集群包括：
	
		- IP PBX系统：呼叫控制
		- 负载均衡器：流量分发
		- 呼叫队列管理
		- 智能路由系统
	
3. 媒体服务器集群，包含：
	
		- RTP媒体处理：处理实时音视频流
		- 编解码转换：处理不同编码格式转换
		- 会议混音：处理多方通话
	  
主要连接关系：
	1. IP网关层 -> SIP服务集群 -> PBX系统集群/媒体服务器集群
	2. TDM网关层 -> PBX系统集群
	3. PBX系统集群 <-> 媒体服务器集群
	4. PBX系统集群 -> 人工座席/自动服务
	5. 媒体服务器集群 -> 自动服务（用于IVR、语音机器人等）
	6. 业务服务层
	SIP服务器作为核心组件承担了信令处理的职责，而媒体服务器则负责实际的音视频流处理。

固话用户呼叫流程
	- **呼叫建立阶段**：当呼叫中心的坐席发起一个外部呼叫时，IP - PBX 首先将呼叫请求发送到 SIP 服务器。SIP 服务器根据呼叫的目的地（如外部电话号码）判断需要使用 SIP 中继来完成呼叫。它会对呼叫请求进行处理，包括查找合适的 SIP 中继线路（可能会根据运营商、费用、线路质量等因素选择），然后通过选定的 SIP 中继将呼叫请求发送到外部通信网络。
	- **通话过程中**：在通话进行期间，SIP 服务器会持续监控通话状态。如果需要进行通话参数的调整（如改变语音编码格式以适应网络状况），SIP 服务器会协调双方的设备进行协商。同时，语音数据通过 SIP 中继在企业内部网络和外部通信网络之间传输。SIP 服务器和 SIP 中继相互配合，确保语音数据能够顺畅地通过不同的网络环境。
	- **呼叫结束阶段**：当通话结束时，无论是坐席还是外部客户挂断电话，设备会发送一个 BYE 消息给 SIP 服务器。SIP 服务器收到消息后，会终止会话，并通知相关的 SIP 中继释放资源，如停止占用的带宽和通信线路，从而完成整个呼叫过程。

移动用户呼叫流程
	当企业呼叫中心基于 VoIP 技术（如通过 SIP 协议），并且希望直接与移动网络进行高效、安全的通信，SBC 可以作为中间设备连接 GMSC。SBC 在这里起到了对语音会话进行管理、转换和安全保障的作用。例如，它可以将来自企业 VoIP 网络的 SIP 协议呼叫进行处理，包括 NAT 穿越、协议适配等操作，然后将适配后的呼叫通过与 GMSC 的连接传输到移动网络，使得呼叫能够顺利到达手机用户。

#### 5. 业务服务层

- 人工座席服务:
	- 座席工作站
	- 座席主管
	- 质检人员
- 自动化服务:
	- IVR (交互式语音应答)
	- AI语音机器人
	- AI文本机器人
- 智能服务:
	- NLP处理
	- 语音识别
	- 语音合成
	- 知识库

#### 6. 管理平台

- 实时监控
- 报表系统
- 通话录音
- 数据分析

#### 7. 数据存储层

- 业务数据库
- Redis缓存
- 文件存储

### 业务服务层

#### 人工坐席介绍

座席工作站主要功能：

- 人工交互界面
- 个性化服务处理
- 单人单线处理
- 工作时间服务
- 灵活的处理流程

座席工作站主要协议：
- HTTP/HTTPS：界面交互
- WebSocket：实时状态更新
- REST：业务操作
- WebRTC：语音通话

座席工作站集成特点：
``` python
PBX <-> 座席工作站 <-> 业务系统
   |         |
   |         -> 即时通讯
   -> CTI服务器 -> CRM系统
```

座席工作站架构图：
![座席工作站架构图.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/a267519e2a9bba675cd1a867e4323d49.svg)

#### 传统IVR介绍

IVR系统功能包括：
- 自动化语音交互
- 标准化服务流程
- 大量并发处理
- 7×24小时运行
- 固定的业务流程

IVR主要协议：
- RTP：实时传输语音流
- MRCP：语音识别/合成控制
- SIP：呼叫控制

IVR的集成特点：
``` python
PBX <-> IVR <-> 业务系统
   |     |
   |     -> ASR/TTS
   -> 媒体服务器
```

IVR系统架构图：

![IVR系统架构图.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/2cccfde49b9039c315af66e3850c7ead.svg)

#### 大模型加持的IVR升级

在传统IVR的基础上增加AI Agent的能力，包括大语音模型、知识库和Agent框架，完善IVR机器人的能力，开源框架包括：TEN-Agent。需要进行一些语音流的编排，集成LLM、知识库和语音工具。这种方式提升了智能性，：

- 更自然的对话理解
- 上下文理解能力强
- 多轮对话推理
- 知识迁移能力强

![智能客服架构图.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/b98cad691e334e5994564fa448603671.svg)

#### 智能Agent实时语音的实现

智能Agent直接接入了端到端的实时AI语音API，在智能ISV的优势上，可以进行情感分析、直接打断，低延迟，交互体验方式更自然。

智能语音Agent支持WebSocket和WebRTC两种通信协议。OpenAI实时语音API属于WebSocket协议，LiveKit的实时语音API属于WebRTC协议。

![智能Agent系统架构.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/a8ed7f53db1c57d03068e3bdcb6dea48.svg)


#### 流程图

VoIP系统可以同时接入IVR和座席工作站，在引入AI Agent时可以有多种灵活的组合方式。
![呼叫中心流程图.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/047918a3b8a68e3fe3f519fb5707f6fb.svg)



#### 测试

<div class="mermaid">

graph TB

    A[开始] --> B{判断}

    B -- Yes --> C[执行]

    B -- No --> D[结束]

    C --> D

</div>

