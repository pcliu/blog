---
title: 2024-11-22-呼叫中心和AI Agent集成
date: 2024-11-22 11:30:11 +0800
categories: 技术
tags:
  - AI
  - 呼叫中心
  - 实时语音
layout: single
toc: "true"
toc_label: 目录
toc_icon: list
toc_sticky: "true"
sidebar:
  nav: docs
comments: "true"
---
### 呼叫中心完整架构图

这个架构支持多种服务模式的无缝切换，并可以根据不同场景智能调度到相应的服务模块。

![呼叫中心架构图.svg](https://d2m4tio3tm4t0x.cloudfront.net/2024/11/b0cdd7e139085b5d7e2cb561827f49f8.svg)

1. PSTN网络层:

	- 本地交换机(Local Exchange): 处理本地固定电话接入
	- 中继线路(Trunk Line): 连接PSTN网络与呼叫中心
	- E1网关: 处理E1数字中继接入
	- SS7信令网关: 处理SS7信令
	- PRI中继网关: 处理ISDN PRI接入

2. 运营商网络层:

	- 移动交换中心(MSC): 处理移动用户接入
	- 网关移动交换中心(GMSC): 连接移动网络与VoIP网络

3. 网关层细分:

	- TDM网关层: 处理传统电路交换网络接入
	- IP网关层: 
		-  SBC(Session Border Controller): 处理外部电话接入
		- WebRTC网关: 支持网页端实时通讯
		- SIP网关: 处理SIP协议通信
	
	  主要连接关系:
		1. 固定电话用户 -> 本地交换机 -> 中继线路 -> TDM网关(E1/SS7/PRI)
		2. 移动用户 -> MSC -> GMSC -> SBC
		3. 网页用户 -> WebRTC网关
		4. APP用户 -> SIP网关


4. 核心服务层

	1. 增加了SIP服务集群，包含：
	
		- 注册服务器(Registration Server)：处理终端注册
		- 代理服务器(Proxy Server)：处理SIP信令路由
		- 定位服务器(Location Server)：管理用户位置信息
	
	2. 重组了PBX系统集群，包括：
	
		- IP PBX系统：呼叫控制
		- 负载均衡器：流量分发
		- 呼叫队列管理
		- 智能路由系统
	
	3. 新增了媒体服务器集群，包含：
	
		- RTP媒体处理：处理实时音视频流
		- 编解码转换：处理不同编码格式转换
		- 会议混音：处理多方通话
	  
	主要连接关系：
	1. IP网关层 -> SIP服务集群 -> PBX系统集群/媒体服务器集群
	2. TDM网关层 -> PBX系统集群
	3. PBX系统集群 <-> 媒体服务器集群
	4. PBX系统集群 -> 人工座席/自动服务
	5. 媒体服务器集群 -> 自动服务（用于IVR、语音机器人等）
	6. 业务服务层
	SIP服务器作为核心组件承担了信令处理的职责，而媒体服务器则负责实际的音视频流处理。

5. 业务服务层

	- 人工座席服务:
	    - 座席工作站
	    - 座席主管
	    - 质检人员
	- 自动化服务:
	    - IVR (交互式语音应答)
	    - AI语音机器人
	    - AI文本机器人
	- 智能服务:
	    - NLP处理
	    - 语音识别
	    - 语音合成
	    - 知识库

6. 管理平台

	- 实时监控
	- 报表系统
	- 通话录音
	- 数据分析

7. 数据存储层

	- 业务数据库
	- Redis缓存
	- 文件存储

### 业务服务层

#### 人工坐席介绍

座席工作站主要功能：

- 人工交互界面
- 个性化服务处理
- 单人单线处理
- 工作时间服务
- 灵活的处理流程

座席工作站主要协议：
- HTTP/HTTPS：界面交互
- WebSocket：实时状态更新
- REST：业务操作
- WebRTC：语音通话
座席工作站集成特点：
```
PBX <-> 座席工作站 <-> 业务系统
   |         |
   |         -> 即时通讯
   -> CTI服务器 -> CRM系统
```



```mermaid
flowchart TB
    
    subgraph 座席工作站
        direction TB
        A2[CTI界面] -->|HTTP/WebSocket| B2[界面服务]
        A2 -->|SIP/WebRTC| C2[软电话模块]
        B2 -->|HTTP/REST| D2[业务系统]
        B2 -->|WebSocket| E2[即时通讯]
        B2 -->|HTTP/WebSocket| F2[状态管理]
    end
    
    style 座席工作站 fill:#e6f3ff,stroke:#333,stroke-width:2px
```


#### 传统IVR介绍

IVR系统功能包括：
- 自动化语音交互
- 标准化服务流程
- 大量并发处理
- 7×24小时运行
- 固定的业务流程

IVR主要协议：
- RTP：实时传输语音流
- MRCP：语音识别/合成控制
- SIP：呼叫控制

IVR的集成特点：
```
PBX <-> IVR <-> 业务系统
   |     |
   |     -> ASR/TTS
   -> 媒体服务器
```



```mermaid
flowchart TB
    subgraph IVR系统
        direction TB
        A1[语音交互引擎] -->|RTP/MRCP| B1[语音识别ASR]
        A1 -->|RTP/MRCP| C1[语音合成TTS]
        A1 -->|SIP/RTP| D1[媒体服务器]
        A1 -->|内部API| E1[业务规则引擎]
        E1 -->|HTTP/DB| F1[后端服务]
    end
    
    style IVR系统 fill:#f5f5f5,stroke:#333,stroke-width:2px
```


#### 大模型加持的IVR升级

在传统IVR的基础上增加AI Agent的能力，包括大语音模型、知识库和Agent框架，完善IVR机器人的能力，开源框架包括：TEN-Agent

```mermaid
graph TB
    %% 业务层架构
    subgraph Service[智能客服业务层]
        subgraph AutoService[自动化服务层]
            subgraph Traditional_IVR[传统IVR服务]
                IVR[IVR引擎]
                FlowEngine[流程引擎]
                MenuConfig[菜单配置]
            end
            
            subgraph AI_Service[智能机器人服务]
                VoiceBot[语音机器人]
                ChatBot[文本机器人]
                Dispatcher[对话管理]
            end
        end
        
        subgraph Intelligence[智能服务平台]
            subgraph BasicAI[基础AI能力]
                ASR[语音识别]
                TTS[语音合成]
                NLP[自然语言处理]
            end
            
            subgraph AdvancedAI[高级AI能力]
                LLM[大语言模型]
                Intent[意图识别]
                Sentiment[情感分析]
            end
            
            subgraph Knowledge[知识库服务]
                KnowledgeBase[知识库]
                VectorDB[向量数据库]
                FAQ[标准问答库]
            end
        end
    end
    
    %% 简化连接关系
    %% 语音相关
    IVR --> ASR & TTS
    VoiceBot --> ASR & TTS
    
    %% 对话理解
    ChatBot & VoiceBot --> NLP
    
    %% 智能处理
    NLP --> Intent
    Intent --> LLM
    LLM --> KnowledgeBase
    
    %% 流程管理
    FlowEngine --> MenuConfig
    Dispatcher --> LLM
    
    %% 知识库访问
    KnowledgeBase --> VectorDB & FAQ
    
    %% 样式定义
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px
    classDef service fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef traditional fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef ai fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef intelligence fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef knowledge fill:#fbe9e7,stroke:#c62828,stroke-width:2px
    
    %% 应用样式
    class Service,AutoService service
    class Traditional_IVR,IVR,FlowEngine,MenuConfig traditional
    class AI_Service,VoiceBot,ChatBot,Dispatcher ai
    class Intelligence,BasicAI,AdvancedAI intelligence
    class Knowledge,KnowledgeBase,VectorDB,FAQ knowledge
```


#### 智能Agent的实现

智能语音Agent支持WebSocket和WebRTC两种通信协议。OpenAI实时语音API属于WebSocket协议，LiveKit的实时语音API属于WebRTC协议。

```mermaid
graph TB
    CALL((来电)) -->|SIP| VOIP[VoIP系统]
    
    %% 主要路由分支
    VOIP -->|路由1| IVR[IVR系统]
    VOIP -->|路由2| AGENT[人工座席]
    VOIP -->|路由3| WS_AI[WebSocket AI]
    VOIP -->|路由4| RTC_AI[WebRTC AI]
    
    %% WebSocket AI路径
    subgraph WebSocket通道
        WS_AI --> MEDIA_GW[媒体网关]
        MEDIA_GW -->|音频流转换| WS_AGENT[WS AI Agent]
        MEDIA_GW -->|WebSocket| WS_AGENT
    end
    
    %% WebRTC AI路径
    subgraph WebRTC通道
        RTC_AI --> RTC_GW[WebRTC网关]
        RTC_GW -->|WebRTC| RTC_AGENT[WebRTC AI Agent]
    end
    
    %% 转人工处理
    WS_AGENT -->|转人工| AGENT
    RTC_AGENT -->|转人工| AGENT
    
    %% 样式定义
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px
    classDef ws fill:#e6f3ff,stroke:#333,stroke-width:2px
    classDef rtc fill:#f0fff0,stroke:#333,stroke-width:2px
    
    class WebSocket通道 ws
    class WebRTC通道 rtc
```

#### 流程图

VoIP系统可以同时接入IVR和座席工作站，在引入AI Agent时可以有多种灵活的组合方式。

```mermaid
graph TD
    CALL((来电)) -->|SIP| VOIP[VoIP系统]
    
    %% 主要路由分支
    VOIP -->|路由1| IVR_MODE[IVR服务]
    VOIP -->|路由2| AGENT_MODE[座席服务]
    VOIP -->|路由3| AI_MODE[AI服务]
    
    %% IVR模式细节
    subgraph IVR["IVR处理流程"]
        IVR_MODE --> TIVR[传统IVR]
        IVR_MODE --> SIVR[智能IVR]
        SIVR -->|故障| TIVR
        TIVR -->|转人工| AGENT_MODE
    end
    
    %% 座席模式细节
    subgraph AGENT["座席处理流程"]
        AGENT_MODE --> SOFT[软电话工作站]
        AGENT_MODE --> PHONE[IP话机]
        SOFT --> AI_HELP[AI助手]
        PHONE --> AI_HELP
    end
    
    %% AI模式细节
    subgraph AI["AI处理流程"]
        AI_MODE --> AI_ENGINE[AI对话引擎]
        AI_ENGINE -->|转人工| AGENT_MODE
        AI_ENGINE -->|降级| IVR_MODE
    end

    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px
    classDef highlight fill:#e6f3ff,stroke:#333,stroke-width:2px
    
    class IVR,AGENT,AI highlight
    class CALL,VOIP default
```
